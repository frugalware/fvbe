#!/bin/sh

set -e

error()
{
  echo "$1"
  exit 1
}

while test -n "$1"; do
  case $1 in

    --arch)
      ARCH="$2"
      shift
      ;;

    --release)
      RELEASE="$2"
      shift
      ;;

    --type)
      TYPE="$2"
      shift
      ;;

    --branch)
      BRANCH="$2"
      shift
      ;;

    *)
      error "Unrecognized argument: $1"
      ;;

  esac

  shift
done

if test -z "$ARCH"; then
  error "ARCH is not defined."
fi

if test -z "$RELEASE"; then
  error "RELEASE is not defined."
fi

if test -z "$BRANCH"; then
  error "BRANCH is not defined."
fi

if test -z "$TYPE"; then
  error "TYPE is not defined."
fi

if test "$TYPE" = "basic"; then
  PACKAGES="base"
elif test "$TYPE" = "full"; then
  PACKAGES="apps base devel gnome kde lib multimedia network x11 xapps xfce4 xlib xmultimedia"
elif test "$TYPE" = "net"; then
  PACKAGES=""
fi

rm -f fvbe.conf
cp -f fvbe-skel.conf fvbe.conf

sed -i "s|^FVBE_ARCH=.*\$|FVBE_ARCH=\"$ARCH\"|"                             fvbe.conf
sed -i "s|^FVBE_ISO_RELEASE=.*\$|FVBE_ISO_RELEASE=\"$RELEASE\"|"            fvbe.conf
sed -i "s|^FVBE_ISO_TYPE=.*\$|FVBE_ISO_TYPE=\"$TYPE\"|"                     fvbe.conf
sed -i "s|^FVBE_ROOTFS_REPOSITORY=.*\$|FVBE_ROOTFS_REPOSITORY=\"$BRANCH\"|" fvbe.conf
sed -i "s|^FVBE_ISO_PACKAGES=.*\$|FVBE_ISO_PACKAGES=\"$PACKAGES\"|"         fvbe.conf
