#!/bin/sh

set -e

. ./fvbe.conf

# Create the skeleton directory.
mkdir -p $FVBE_ROOT/{boot/grub,LiveOS}

# Setup kernel and initrd.
cp vmlinuz $FVBE_ROOT/boot/vmlinuz
cp initrd $FVBE_ROOT/boot/initrd

# Setup squashfs image.
cp squashfs.img $FVBE_ROOT/LiveOS/squashfs.img

# Setup grub2 config.
cat > $FVBE_ROOT/boot/grub/grub.cfg << EOF
search --no-floppy --set=root --label FVBE
terminal_input console
terminal_output console

insmod efi_gop
insmod efi_uga

set locale=fr_FR.utf8

menuentry 'Frugalware (Normal)' {
  linux /boot/vmlinuz root=live:CDLABEL=FVBE video=800x600 locale.LANG=\$locale
  initrd /boot/initrd
}

submenu 'Frugalware Locale' {
  menuentry 'en_US.utf8' {
    set locale=en_US.utf8
  }
}
EOF

# Create the ISO.
grub-mkrescue -o fwlive.iso $FVBE_ROOT -- -boot_image any partition_offset=16 -volid FVBE

# Delete the root directory.
#rm -rf $FVBE_ROOT
