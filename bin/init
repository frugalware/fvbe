#!/bin/sh

bad_exit()
{
  echo "Build has failed!"
  qemu-exit
}

good_exit()
{
  echo "Build has finished!"
  qemu-exit
}

trap bad_exit ERR
trap good_exit EXIT

ROOT="/root"
PATH="/sbin:/usr/sbin:/bin:/usr/bin"

export PATH

if ! test -c /dev/zero; then
  mount -t devtmpfs none /dev
fi

if ! test -d /sys/kernel; then
  mount -t sysfs none /sys
fi

if ! test -d /proc/self; then
  mount -t proc none /proc
fi

if ! test -d "$ROOT"; then
  mkdir -p -m 0755 "$ROOT"
fi

if ! test -d /dev/pts; then
  mkdir -p -m 0755 /dev/pts
  mount -t devpts -o gid=5,mode=620 none /dev/pts
fi

if ! test -d /dev/shm; then
  mkdir -p -m 0755 /dev/shm
  mount -t tmpfs none /dev/shm
fi

